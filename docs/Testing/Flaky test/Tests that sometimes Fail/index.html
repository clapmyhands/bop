<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/bop/styles.24acb70e5693e6383b9a.css" id="gatsby-global-css">.popover{position:relative;max-width:16rem;box-shadow:0 10px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05);padding:1rem;border:1px solid var(--separator);border-radius:.5rem;background-color:var(--references-bg);max-height:16rem;overflow:hidden}.popover.no-max-width{max-width:90vw}.popover.with-markdown{font-size:.875rem}.popover h1{margin:0;padding:0;font-size:1rem}.popover ul{padding-left:1rem}.popover .more-content-blind{height:4rem;position:absolute;background:transparent;background:linear-gradient(0,var(--references-bg),var(--references-bg-80) 50%,var(--references-bg-0));top:12rem;width:100%;left:0}.tippy-box[data-animation=shift-away][data-state=hidden]{opacity:0}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=top]{transform:translateY(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=bottom]{transform:translateY(-10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=left]{transform:translateX(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=right]{transform:translateX(-10px)}.reference{text-decoration:none}.reference:hover{color:var(--references-highlight)}.reference>div{padding-top:.5rem;padding-bottom:.5rem}.reference>div>p{margin:0;font-size:.875rem}.reference>div>ul{margin:0}.references-block{color:var(--references-text);padding:1rem;margin:1rem 0;border-radius:.5rem;background-color:var(--references-bg);transition:background-color .3s ease,color .3s ease}.references-block>div{margin-bottom:1rem}.references-block>hr{margin-left:auto;margin-right:auto;width:8rem}.references-block a{color:var(--references-text);transition:color .3s ease}.references-block>p:last-child{margin-bottom:0}.note-container{background:var(--note-bg);transition:background .3s ease}.note-container:first-child{border-left:none}.note-container .note-content,.note-container .obstructed-label{transition:opacity 75ms linear}.note-container .obstructed-label{display:block;color:var(--text);text-decoration:none;font-size:17px;line-height:40px;font-weight:500;-ms-writing-mode:tb-lr;writing-mode:vertical-lr;margin-top:36px;top:0;bottom:0;left:0;position:absolute;background-color:transparent;width:40px;overflow:hidden;opacity:0;transition:color .3s ease;pointer-events:none}.note-container.note-container-highlighted{background:var(--references-bg);transition:background .3s ease}.note-content img{max-width:100%}@media screen and (max-width:800px){.note-container{padding:16px;width:100%;overflow-y:auto}}@media screen and (min-width:801px){.note-container{transition:box-shadow .1s linear,opacity 75ms linear,transform .2s cubic-bezier(.19,1,.22,1);flex-shrink:0;width:625px;max-width:625px;top:0;position:-webkit-sticky;position:sticky;flex-grow:1;border-left:1px solid var(--separator);padding:0}.note-content{overflow-y:auto;height:100%;padding:32px}.note-container-overlay{box-shadow:0 0 15px 3px var(--shadow)}.note-container-obstructed .note-content{opacity:0}.note-container-obstructed .obstructed-label{opacity:1;pointer-events:all}}.dark-mode-toggle{cursor:pointer;transform:scale(.6)}.dark-mode-toggle input{display:none}.dark-mode-toggle input+div{border-radius:50%;width:36px;height:36px;position:relative;box-shadow:inset 16px -16px 0 0 #fff;transform:scale(1) rotate(-2deg);transition:box-shadow .5s ease 0s,transform .4s ease .1s}.dark-mode-toggle input+div:before{content:"";width:inherit;height:inherit;border-radius:inherit;position:absolute;left:0;top:0;transition:background .3s ease}.dark-mode-toggle input+div:after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--link),0 23px 0 var(--link),23px 0 0 var(--link),-23px 0 0 var(--link),15px 15px 0 var(--link),-15px 15px 0 var(--link),15px -15px 0 var(--link),-15px -15px 0 var(--link);transform:scale(0);transition:all .3s ease}.dark-mode-toggle input:checked+div{box-shadow:inset 32px -32px 0 0 #fff;transform:scale(.5) rotate(0deg);transition:transform .3s ease .1s,box-shadow .2s ease 0s}.dark-mode-toggle input:checked+:before{background:var(--link);transition:background .3s ease .1s}.dark-mode-toggle input:checked+:after{transform:scale(1.5);transition:transform .5s ease .15s}.graph-button{border:0;background:none;cursor:pointer}.graph-button svg g{stroke:var(--link)}.searchWrapper{position:relative;display:block}.inputWrapper{position:relative;color:var(--text)}.inputWrapper .searchIcon{position:absolute;fill:var(--link);left:2px;height:34px;padding:2px 2px 0;pointer-events:none}.inputWrapper input{color:var(--text);font-size:1rem;border:none;height:36px;padding-left:28px;background-color:var(--note-bg);transition:all .3s ease-in-out;width:28px}.inputWrapper input:focus{outline:none;width:100%}.results{-webkit-padding-start:0;padding-inline-start:0;position:absolute;display:block;top:100%;right:0;width:500px;max-height:50vh;background:var(--note-bg);box-shadow:-5px -5px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05);overflow-y:auto;border-radius:8px}.results li{display:block;text-decoration:none;cursor:pointer;padding:16px 24px;border-bottom:1px solid var(--separator)}.results li:hover{background:var(--references-bg)}.results li .title{color:var(--text)}.results li .excerpt{color:var(--references-text)}@media screen and (max-width:600px){.results{right:-85px;width:calc(100vw - 40px)}}.lds-dual-ring:after{content:" ";left:calc(50% - 32px);position:relative;display:block;width:64px;height:64px;margin:8px;border-radius:50%;border-color:var(--separator);border-left:6px solid transparent;border-bottom:6px solid var(--separator);border-right:6px solid transparent;border-top:6px solid var(--separator);animation:lds-dual-ring 1.2s ease-in-out infinite}@keyframes lds-dual-ring{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}header{width:100%;min-height:57px;z-index:5;background-color:var(--note-bg);border-bottom:1px solid var(--separator);display:flex;justify-content:space-between;align-items:center;padding:10px 32px;flex-wrap:wrap;transition:background-color .3s ease}header>a{font-weight:700;color:var(--text);text-decoration:none;transition:color .3s ease}header .controls{display:flex}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body.light-mode{--main-bg:#fafafc;--note-bg:#fff;--text:#1a202c;--separator:#e2e8f0;--shadow:rgba(0,0,0,0.1);--link:#3182ce;--references-bg:#ebf4ff;--references-bg-80:rgba(235,244,255,0.8);--references-bg-0:rgba(235,244,255,0);--references-text:#718096;--references-highlight:#4a5568}body.dark-mode{--main-bg:#000;--note-bg:#0a0d11;--text:#fafafc;--separator:#252525;--shadow:hsla(0,0%,100%,0.1);--link:#3da1ff;--references-bg:#17181a;--references-bg-80:rgba(23,24,26,0.8);--references-bg-0:rgba(23,24,26,0);--references-text:#8c9fbb;--references-highlight:#b3cbf0}body{background-color:var(--main-bg);color:var(--text);margin:0;padding:0;height:100vh;transition:background-color .3s ease,color .3s ease}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}*,:after,:before{box-sizing:border-box}h1,h2,h3{font-weight:700}hr{margin-top:1rem;margin-bottom:1rem;border:solid var(--separator);border-width:1px 0 0;box-sizing:content-box;height:0;overflow:visible}a{color:var(--link);text-decoration:underline;transition:color .3s ease}a:hover{text-decoration:none}h1{font-size:1.875rem;margin-top:1rem}h1,p{margin-bottom:1rem}.layout{height:100vh;display:flex;flex-direction:column}.note-columns-scrolling-container{display:flex;overflow-x:auto;overflow-y:hidden;flex-grow:1}.note-columns-container{display:flex;flex-grow:1;transition:width .1s cubic-bezier(.19,1,.22,1)}@media screen and (max-width:800px){.note-columns-container{width:unset!important}}.overlay{z-index:98;position:fixed;top:0;right:0;bottom:0;left:0;display:flex;align-items:center;justify-content:center;height:100%;width:100%;background-color:var(--shadow);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal{z-index:99;position:fixed;border-radius:8px;background-color:var(--main-bg);box-shadow:-5px -5px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05)}.modal-close,.modal-scale{position:absolute;top:0;right:0;padding:5px;border:0;background:none;color:var(--text);cursor:pointer}.modal-close svg,.modal-scale svg{width:20px;height:20px}.modal-close path,.modal-scale path{fill:currentColor}.modal-scale{right:30px}.modal-minimized .modal-close svg,.modal-minimized .modal-scale svg{width:15px;height:15px}.modal-minimized .modal-scale{right:25px}.modal-body{height:100%;width:100%}.modal-body .node,.modal-body .text{cursor:pointer}</style><meta name="generator" content="Gatsby 2.32.13"/><link as="script" rel="preload" href="/bop/component---node-modules-gatsby-theme-garden-src-templates-local-file-js-f4932d88b9f21a180b38.js"/><link as="script" rel="preload" href="/bop/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/bop/app-8915cc63ba8778201f39.js"/><link as="script" rel="preload" href="/bop/framework-06f646d936b841f99ebd.js"/><link as="script" rel="preload" href="/bop/webpack-runtime-d8ce7b152f0932e3b0ab.js"/><link as="fetch" rel="preload" href="/bop/page-data/docs/Testing/Flaky test/Tests that sometimes Fail/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/bop/page-data/sq/d/2098632890.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/bop/page-data/sq/d/2221750479.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/bop/page-data/sq/d/2468095761.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/bop/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><header><a href="/bop/"><h3>Foam</h3></a><div class="controls"><div class="searchWrapper" role="combobox" aria-expanded="false" aria-haspopup="listbox" aria-labelledby="downshift-15-label"><div class="inputWrapper"><svg class="searchIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M23.111 20.058l-4.977-4.977c.965-1.52 1.523-3.322 1.523-5.251 0-5.42-4.409-9.83-9.829-9.83-5.42 0-9.828 4.41-9.828 9.83s4.408 9.83 9.829 9.83c1.834 0 3.552-.505 5.022-1.383l5.021 5.021c2.144 2.141 5.384-1.096 3.239-3.24zm-20.064-10.228c0-3.739 3.043-6.782 6.782-6.782s6.782 3.042 6.782 6.782-3.043 6.782-6.782 6.782-6.782-3.043-6.782-6.782z"></path></svg><input type="text" aria-autocomplete="list" aria-labelledby="downshift-15-label" autoComplete="off" value="" id="downshift-15-input" placeholder="Search..."/></div></div><button title="Show Graph visualisation" aria-label="Show Graph visualisation" class="graph-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20"><g fill="none" stroke-width="2"><circle cx="11.733" cy="3.181" r="1.902"></circle><circle cx="16.864" cy="10.861" r="1.902"></circle><circle cx="7.47" cy="16.822" r="1.902"></circle><circle cx="3.046" cy="6.275" r="1.902"></circle><circle cx="9.372" cy="10.861" r="1.902"></circle><line x1="11.635" x2="14.655" y1="10.861" y2="10.861"></line><line x1="10" x2="10.895" y1="8.959" y2="5.573"></line><line x1="7.47" x2="4.5" y1="9.68" y2="7.5"></line><line x1="8.25" x2="8.809" y1="14.92" y2="13.088"></line></g></svg></button><label class="dark-mode-toggle" aria-label="Activate dark mode" title="Activate dark mode"><input type="checkbox" checked=""/><div></div></label></div></header><div class="note-columns-scrolling-container"><div class="note-columns-container" style="width:1250px"><div class="note-container   " style="left:0;right:-585px"><div class="note-content"><h1 id="tests-that-sometimes-failed">Tests that sometimes failed</h1><p>link: <!-- -->[https://samsaffron.com/archive/2019/05/15/tests-that-sometimes-fail]</p><ul><li><a href="#1-definition">1. Definition</a></li><li><a href="#2-background">2. Background</a></li><li><a href="#3-several-pattern-of-flakiness">3. Several pattern of Flakiness</a><ul><li><a href="#31-hard-coded-id">3.1. Hard coded id</a></li><li><a href="#32-random-data">3.2. Random data</a></li><li><a href="#33-database-execution-ordering-assumptions">3.3. Database execution ordering assumptions</a></li><li><a href="#34-time-assumptions">3.4. Time assumptions</a></li><li><a href="#35-concurrency">3.5. Concurrency</a></li><li><a href="#36-leaky-global-state">3.6. Leaky global state</a></li><li><a href="#37-assumptions-about-environment">3.7. Assumptions about environment</a></li></ul></li><li><a href="#4-how-to-handle-flaky-test">4. How to handle Flaky test</a></li></ul><h2 id="1-definition">1. Definition</h2><p>Sometimes when tests are written, they might become test that fails intermittently. These are called flaky test or heisentest (in relation to <a href="https://en.wikipedia.org/wiki/Heisenbug">heisenbug</a>)</p><h2 id="2-background">2. Background</h2><p>Flaky test incurs cost not only in time spent on the pipeline, but also on developer&#x27;s time.
Hence it is crucial that we either remove flakiness or fix it.
Fixing flaky tests might also result in fixing an actual bug hidden inside the code.</p><h2 id="3-several-pattern-of-flakiness">3. Several pattern of Flakiness</h2><h3 id="31-hard-coded-id">3.1. Hard coded id</h3><p>When using database with auto increment ids, sometimes its easier for us to simply assign id and check whether it is equal to some hard coded id.
This can be further generalized as any hardcoded assumptions.
TODO: reread and fix this part</p><h3 id="32-random-data">3.2. Random data</h3><p>some unexpected data/input can expose a bug or a wrong assumption deep inside the code.
This is how Fuzzy testing (or commonly known as <a href="https://en.wikipedia.org/wiki/Fuzzing">Fuzzing</a> come to be.
Fuzzy testing work by generating random data with some restriction which is used to hit the system.</p><h3 id="33-database-execution-ordering-assumptions">3.3. Database execution ordering assumptions</h3><p>this is related to point 1 in that order should not be assumed unless explicitly ordered by the developer (no pun intended)</p><h3 id="34-time-assumptions">3.4. Time assumptions</h3><p>Time is one of those things that we don&#x27;t usually think about testing for/about; because, how can Time fail?
However, code that is basing its logic on time can fail and code should be designed to be easily testable even against time.</p><p>Related to this is places where we use time.Sleep to wait on some asynchronous or background processing.
This is a typical flaky smell; not only does this make your test take longer, it&#x27;s also implicit on what it&#x27;s waiting for.
If the code needs to take some specific amount of time, then it should be explicit.
Otherwise, Test should not rely on sleep to wait on some correct state.
Instead, use polling or some explicit way to sync the state.
Possibly by calling a function and processing it synchronously instead of waiting on some state to be true.</p><h3 id="35-concurrency">3.5. Concurrency</h3><p>Semi-related to <a href="#time-assumptions">time assumptions</a>.
If we use background processing in test, it could result race condition.
Especially if tests are run in parallel.</p><h3 id="36-leaky-global-state">3.6. Leaky global state</h3><p>Sometimes tests modifies some global state.
Unless the test suite are reset to a pristine state, there can be some modified global state between tests.
This would result in some condition being true only if tests are run in certain order.
Hence why tests should always be run in random order.</p><h3 id="37-assumptions-about-environment">3.7. Assumptions about environment</h3><p>Remember that in the end your code are not only running locally.
It is also tested locally, in CI/CD pipeline, and running in production.
It is hard to make sure the condition is always the same (even if you use container).
There will be small differences here and there and thats why you should challenge your assumptions.
TODO: reread this part and fix</p><h2 id="4-how-to-handle-flaky-test">4. How to handle Flaky test</h2><p>Handling flaky test should be a team effort.
Assign flaky test to original test writer to fix, and give post mortem on how it come to be.
Treat it like an incident and figure out the root cause.</p><p>Below are several points on how to work as a team to reduce flakiness:</p><ol><li>Should be a team concern
It should be a team decision to either remove, run repeatedly, ignore, or invest time to find cause and fix</li><li>Stopping deployment if any test failed
Depends on urgency, when deployment timeline is tight, test can be quarantined/excluded temporarily</li><li>Run test in random order</li><li>Invest in making tests run faster
Tighter loop means it can be run faster on a loop and flaky test are found faster</li><li>Regularly run test suite
This can be done in asynchronous manner to actual code change to prod.
Very rare flaky test can be found if your test suite are fast and you&#x27;re running it endlessly (even if say chance of happening is 1/xxxxx)</li><li>Add log in unexpected flaky case</li></ol></div><a class="obstructed-label" href="/bop/docs/Testing/Flaky test/Tests that sometimes Fail">Tests that sometimes failed</a></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/docs/Testing/Flaky test/Tests that sometimes Fail";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b26ca15045427b9506aa.js"],"app":["/app-8915cc63ba8778201f39.js"],"component---node-modules-gatsby-theme-garden-src-templates-local-file-js":["/component---node-modules-gatsby-theme-garden-src-templates-local-file-js-f4932d88b9f21a180b38.js"]};/*]]>*/</script><script src="/bop/polyfill-b26ca15045427b9506aa.js" nomodule=""></script><script src="/bop/webpack-runtime-d8ce7b152f0932e3b0ab.js" async=""></script><script src="/bop/framework-06f646d936b841f99ebd.js" async=""></script><script src="/bop/app-8915cc63ba8778201f39.js" async=""></script><script src="/bop/styles-407fe62976dc5310c43e.js" async=""></script><script src="/bop/component---node-modules-gatsby-theme-garden-src-templates-local-file-js-f4932d88b9f21a180b38.js" async=""></script></body></html>